sudo: false
notifications:
  email:
    on_success: never
    on_failure: always
language: node_js
branches:
  only:
  - master
  - /^v\d+\.\d+\.\d+$/
stages:
  - test
  - deploy
jobs:
  include:
    - stage: test
      node_js: 10
      script: ./scripts/test.bash :unit
    - stage: test
      node_js: 8
      before_script: npm install coveralls
      script:
        - ./scripts/test.bash :coverage
        - ./scripts/lint.bash
      after_script: nyc report --reporter=text-lcov | coveralls
    - stage: deploy
      node_js: 8
      skip_cleanup: true
      script: ./scripts/build.bash
      deploy:
        provider: npm
        email: mitmaro@gmail.com
        skip_cleanup: true
        api_key:
          secure: "GIF/xa6bKBvOt9qUWKgifHzwIVgctKy1HMAhuNGzbST/lK0h9YD3ad50WqzXfpCDhzbHAd45JbS1ksszA6n9+S+xEL1aImeyj6x2k4KTtocW0d2W6w6erLLtB0CtTtF8wJwnhrB36sEWs8b1Hrh/onJ/Rrm2fE5zA6Xz4uLlX02r4fNIhorIhly2LT32Bz4T4C9z4bAbpJTVWqUQbK6XNdz8R2voJeMdmXuD8ESIsWIUIE7UUmaBpH8SC16lqUPcAn0AlDk7Y23zWnGUL9mad2KgwK0t2FQyfBP20kdx7wsGD1/rH5ACoTAWGIow3GwpDlE09g2g461jxHlwdek5q3E8KXs1IzIxp1AKgmHt+7CGlCSC9eIhDS1dcmpFU0GbhDKgqsiOVPH6v98qdtE4oJRp2Of0UlP8oXd7k1bxX77dDRnleYyZvm1S78V8NBDtyY1kvfmTdHaKfkr4FOq1lrbv1u6WKyrIKLB7bm9dasxySVzUUhDvnM9cFePALaXI3aI5Xe2PgkqCC6IB0HipB4WufAYV4rrGAl4tVmXLCny1MSnHvKH8B49Dyz3N73YYeVorV8qb4Ib/fyH98nrEQjuoDV4dRmaRZqMPPK4f8ZGhD1BaO34/JugL6WM6PZ7EEI426cPPiuQTokfbLe+9S3gHzE0mw3CEhjSu/+ZWh+8="
        on:
          tags: true
          repo: MitMaro/node-dependency-manager
